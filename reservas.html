<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Solicitudes - Asignaci칩n de Conductor</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/reserva.css">
</head>


<body>

  <div class="container">

    <aside>
            <div class="toggle">
                <div class="logo">
                    <img src="imagenes/3.jpg">
                    <h2><span class="primary">ATP</span></h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-icons-sharp">
                        close
                    </span>
                </div>
            </div>

            <div class="sidebar">
                <a href="#">
                    <span class="material-icons-sharp">
                        dashboard
                    </span>
                    <h3>Dashboard</h3>
                </a>
                <a href="#">
                    <span class="material-icons-sharp">
                        person_outline
                    </span>
                    <h3>Tenista</h3>
                </a>
                <a href="/conductor.html" >
                    <span class="material-icons-sharp">
                        person_outline
                    </span>
                    <h3>Conductores</h3>
                </a>
                <a href="/prueba2.html" class="">
                    <span class="material-icons-sharp">
                        insights
                    </span>
                    <h3>Solicitudes</h3>
                </a>
                <a href="/reservas.html" class="active">
                    <span class="material-icons-sharp">
                        receipt_long
                    </span>
                    <h3>Reservas</h3>
                </a>
                <a href="#">
                    <span class="material-icons-sharp">
                        logout
                    </span>
                    <h3>Cerrar Sesi칩n</h3>
                </a>
            </div>
    </aside>

        <main>
            <h1>Reservas</h1>
            <div class="recent-orders">
                <div class="card">
                    <div class="table-wrap">
                      <table id="tbl-reservas">
                            <thead>
                            <tr>
                                <th>Id</th>
                                <th>Solicitud</th>
                                <th>Conductor</th>
                                <th>Coordinador</th>
                                <th>Fecha agendada</th>
                                <th>Estado</th>
                            </tr>
                            </thead>
                            <tbody id="tbody-reservas">
                            <tr><td colspan="6" style="text-align:center;">Cargando...</td></tr>
                             </tbody>
                        </table>
                    </div>
                </div>
            </div>
          

        </main>

        <div class="right-section">
            <div class="nav">
                <button id="menu-btn">
                    <span class="material-icons-sharp">
                        menu
                    </span>
                </button>
                <div class="dark-mode">
                    <span class="material-icons-sharp active">
                        light_mode
                    </span>
                    <span class="material-icons-sharp">
                        dark_mode
                    </span>
                </div>

                <div class="profile">
                    <div class="info">
                        <p>Hola, <b>Helena</b></p>
                        <small class="text-muted">Coordinador</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

  <script>
    const API_BASE = "https://cute-parrots-itch.loca.lt/api";  // c치mbialo a tu endpoint
    const TOKEN = localStorage.getItem("coord_token") || "";

    async function fetchJSON(url, opts = {}) {
      const headers = {
        "Accept": "application/json",
        ...(opts.method ? { "Content-Type": "application/json" } : {}),
        ...(TOKEN ? { "Authorization": "Bearer " + TOKEN } : {})
      };
      const r = await fetch(url, { ...opts, headers });
      if (!r.ok) throw new Error("Error HTTP " + r.status);
      return r.json();
    }

    function fmtDate(d) {
      return d ? new Date(d).toLocaleString() : "";
    }

    async function loadReservas() {
      try {
        const data = await fetchJSON(`${API_BASE}/reservas/`);
        const reservas = data.results || data;

        if (!reservas.length) {
          document.querySelector("#tbody-reservas").innerHTML =
            `<tr><td colspan="6" style="text-align:center;">No hay reservas</td></tr>`;
          return;
        }

        const rows = reservas.map(r => `
          <tr>
            <td>${r.id}</td>
            <td>${r.solicitud}</td>
            <td>${r.conductor ?? ""}</td>
            <td>${r.coordinador ?? ""}</td>
            <td>${fmtDate(r.fecha_hora_agendada)}</td>
            <td>${r.estado}</td>
          </tr>
        `).join("");

        document.querySelector("#tbody-reservas").innerHTML = rows;
      } catch (e) {
        console.error(e);
        document.querySelector("#tbody-reservas").innerHTML =
          `<tr><td colspan="6" style="text-align:center;color:red;">Error cargando reservas</td></tr>`;
      }
    }

    // inicia carga al abrir p치gina
    loadReservas();
  </script>
    </body>
</html>
